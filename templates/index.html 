<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Paper Finder</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .paper { border: 1px solid #ddd; padding: 10px; margin-bottom: 20px; }
        .vote-buttons { display: flex; gap: 10px; }
        .vote-count { font-weight: bold; }
    </style>
</head>
<body>
    <h1>LLM Paper Finder</h1>
    <form id="preferences-form">
        <label for="preferences">Enter your preferences:</label><br>
        <textarea id="preferences" name="preferences" rows="4" cols="50"></textarea><br>
        <button type="submit">Fetch Papers</button>
    </form>
    <div id="papers-container"></div>
    <button id="download-json">Download JSON</button>

    <script>
        $(document).ready(function() {
            $('#preferences-form').submit(function(e) {
                e.preventDefault();
                $.post('/fetch_papers', $(this).serialize(), function(data) {
                    let papersHtml = data.map(paper => `
                        <div class="paper" data-arxiv-id="${paper.arxiv_id}">
                            <h2>${paper.title}</h2>
                            <p><strong>Authors:</strong> ${paper.authors}</p>
                            <p><strong>Abstract:</strong> ${paper.abstract}</p>
                            <p><a href="${paper.pdf_url}" target="_blank">PDF Link</a></p>
                            <div class="vote-buttons">
                                <button class="upvote">Upvote</button>
                                <button class="downvote">Downvote</button>
                                <span class="vote-count">Votes: ${paper.votes}</span>
                            </div>
                        </div>
                    `).join('');
                    $('#papers-container').html(papersHtml);
                });
            });

            $('#papers-container').on('click', '.upvote, .downvote', function() {
                const arxivId = $(this).closest('.paper').data('arxiv-id');
                const voteType = $(this).hasClass('upvote') ? 'up' : 'down';
                $.post('/vote', {arxiv_id: arxivId, vote_type: voteType}, function(data) {
                    if (data.success) {
                        const voteCountElement = $(`.paper[data-arxiv-id="${arxivId}"] .vote-count`);
                        let currentVotes = parseInt(voteCountElement.text().split(': ')[1]);
                        currentVotes += voteType === 'up' ? 1 : -1;
                        voteCountElement.text(`Votes: ${currentVotes}`);
                    }
                });
            });

            $('#download-json').click(function() {
                window.location.href = '/download_json';
            });
        });
    </script>
</body>
</html>